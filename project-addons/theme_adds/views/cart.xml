<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template id="cart_replace_general" inherit_id="clarico_cart.clarico_clear_cart">
        <xpath expr="//a[@class='clear_shopping_cart']" position="replace">
            <div class="shopping_cart_buttons">
                <a class="btn btn-primary common-btn vrt_algn_top back-to-shopping" href="/" rel="nofollow">
                    <span class="fa fa-long-arrow-left" />
                    Continue Shopping
                </a>
                <span t-if="website_sale_order.amount_total &gt; 0">
                    <a class="clear_shopping_cart btn btn-primary common-btn vrt_algn_top mb4"
                       t-if="website_sale_order and website_sale_order.website_order_line">
                        Clear Cart
                    </a>
                    <a class="btn btn-primary common-btn vrt_algn_top mb4" href="/shop/checkout" rel="nofollow">
                        Process checkout <span class="fa fa-long-arrow-right" />
                    </a>
                </span>
            </div>
            <div class="row empty_cart_message">
                <div class="in-empty_cart_message cart-empty-msg">Your cart is empty!</div>
            </div>
        </xpath>
    </template>

    <template id="cart_banner_replace" inherit_id="clarico_cart.clarico_cart">
        <xpath expr="//div[@class='cart-cover-img-div']" position="replace"/>
        <xpath expr="//div[@class='cart-main-div-full oe_cart']" position="inside">
            <div class="wp-load-spinner-clear-cart">
                <div class="wp-load-spinner"/>
            </div>
        </xpath>
        <xpath expr="//div[@class='cart-main-div-full oe_cart']/div[@class='oe_structure']" position="before">
            <div class="pull-left" t-if="website_sale_order.amount_total &gt; 0">
                <a class="btn btn-primary common-btn back-to-shopping" href="/" rel="nofollow">
                    <span class="fa fa-long-arrow-left" />
                    Continue Shopping
                </a>
            </div>
        </xpath>
    </template>

    <!--<template id="back_to_shop_btn_replace" inherit_id="website_sale.continue_shopping">
        <xpath expr="//a[@href='/shop']" position="attributes">
            <attribute name="onclick">window.history.go(-1); return false;</attribute>
        </xpath>
    </template>-->

    <template id="add_fiction_breadcrumbs_bar" inherit_id="website_sale.cart">
        <xpath expr="//div[@class='container oe_website_sale']" position="before">
            <t t-call="theme_adds.breadcrumbs_fiction_bar"/>
        </xpath>
    </template>

    <template id="add_fiction_breadcrumbs_bar_checkout" inherit_id="website_sale_one_step_checkout.osc_onestepcheckout">
        <xpath expr="//div[@class='container oe_website_sale oe_website_sale_osc']" position="before">
            <t t-call="theme_adds.breadcrumbs_fiction_bar"/>
        </xpath>
    </template>

    <template id="add_accepted_legal_terms_guest_checkout" inherit_id="website_sale_one_step_checkout.address_form">
        <xpath expr="//form" position="inside">
            <t t-if="website.user_id == user_id and not checkout">
                    <div t-attf-class="form-group col-md-12 ">
                        <input type="checkbox"
                               name="accepted_legal_terms"
                               id="accepted_legal_terms"
                               required="required"
                               value=""/>
                        <label for="accepted_legal_terms" class="control-label">
                            <t t-call="website_legal_page.acceptance_full"/>
                        </label>
                    </div>
            </t>
            <t t-else="">
                <div t-attf-class="form-group col-md-12" hidden="1">
                    <input type="checkbox"
                           checked="1"
                           name="accepted_legal_terms"
                           id="accepted_legal_terms"/>
                </div>
            </t>
        </xpath>
    </template>

    <template id="add_fiction_breadcrumbs_bar_onfirmation"  inherit_id="website_sale.confirmation">
		<xpath expr="//div[@class='container oe_website_sale']" position="before">
			<t t-call="theme_adds.breadcrumbs_fiction_bar"/>
		</xpath>
    </template>

    <template id="checkout_product_list_table_head_replace" inherit_id="website_sale_one_step_checkout.osc_onestepcheckout">
        <xpath expr="//table[@id='cart_products']//thead[1]" position="replace">
            <thead>
                  <tr>
                        <th colspan="2">Product</th>
                        <th class="text-center">Qty</th>
                        <th class="text-center">Price</th>
                  </tr>
            </thead>
        </xpath>
    </template>

    <template id="custom_onestepcheckout" inherit_id="website_sale_one_step_checkout.osc_onestepcheckout">

        <!--Adapt payment_acquirer_by_amount to OSC-->
        <xpath expr="//t[@t-foreach]/li" position="replace">
            <t t-if="(not acquirer.min_amount_required and not acquirer.max_amount_required)
                     or (
                        (acquirer.min_amount_required &lt; website_sale_order.amount_total and acquirer.max_amount_required &gt; website_sale_order.amount_total)
                        or (not acquirer.max_amount_required and acquirer.min_amount_required &lt; website_sale_order.amount_total)
                        or (not acquirer.min_amount_required and acquirer.max_amount_required &gt; website_sale_order.amount_total)
                        )">
                <label t-if="acquirer.button">
                    <input t-att-value="acquirer.id"
                           type="radio"
                           name="acquirer"
                           t-att-checked="website_sale_order.payment_acquirer_id == acquirer"/>
                    <span t-field="acquirer.image_small"
                          t-att-title="acquirer.name"
                          t-field-options='{"widget": "image", "style":"max-width: 60px; display: inline-block"}'/>
                    <span t-field="acquirer.name"/>
                    <span t-if="acquirer.fees_active">(processing fees apply)
                    </span>
                </label>
            </t>
        </xpath>

        <!--Para adaptar paga+tarde a osc-->
        <xpath expr="//div[@class='container oe_website_sale oe_website_sale_osc']/div" position="before">
            <div t-if="request.session.get('pmt_tx_error')" class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <div class="alert alert-danger alert-dismissible" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true"><![CDATA[&times;]]></span>
                        </button>
                        <strong>PAGA+TARDE: </strong><span t-esc="request.session.get('pmt_tx_error')"></span>
                    </div>
                </div>
                <div class="col-md-4"></div>
            </div>
        </xpath>

        <!--Instrucciones de pago y simulador-->
        <xpath expr="//div[@id='payment_body_info']" position="inside">
            <span>For select a <strong>"Paga+Tarde"</strong> payment, the total amount must be over 350€.</span>
            <br/>
            <p>
                <!-- Retrive Javascript SDK from CDN -->
                <script type="text/javascript" src="https://cdn.pagamastarde.com/pmt-js-client-sdk/3/js/client-sdk.min.js"></script>
                <!-- Create simulator container -->
                <div class="PmtSimulator"
                     data-pmt-style="Blue"
                     data-pmt-type="6"
                     t-att-data-pmt-amount="website_sale_order.amount_total"
                     t-att-data-pmt-promoted-amount="0">
                </div>
                <!-- Set Public Key and reload simulator -->
                <script>
                    pmtClient.simulator.setPublicKey('pk_fdfadf9090a1c489501d5cb1');
                    pmtClient.simulator.init();
                    pmtClient.simulator.reload();
                </script>
            </p>
            <button class="btn btn-block btn-primary"
                    onclick="pmtClient.modal.open('https://developer.pagamastarde.com/landing/?pmt-pk=pk_fdfadf9090a1c489501d5cb1',
                                    {'closeConfirmationMessage': null, 'largeSize': true});">Ver Instrucciones Paga+Tarde</button>
        </xpath>
    </template>

    <!--Replace default payment delivery-->
    <template id="payment_delivery_replace" name="Delivery Costs" inherit_id="website_sale_one_step_checkout_delivery.payment_delivery">
        <xpath expr="//div[@id='delivery_carrier_osc']" position="replace">
            <div t-if="deliveries" id="delivery_carrier_osc_custom">
                <h3 class="page-header mt16">Send Conditions</h3>

                <div class="panel panel-default border_primary">
                    <div class="panel-body">
                        Free delivery for amounts over € 99 and weight less than 15Kg
                    </div>
                    <div class="panel-footer">
                        <p>Amount to get free delivery:</p>
                        <a t-if="99 - website_sale_order.amount_total &gt; 0" class="btn btn-block btn-primary" >
                            <span t-esc="99 - website_sale_order.amount_total" style="white-space: nowrap;"
                                  t-options="{'widget': 'monetary','from_currency': website_sale_order.pricelist_id.currency_id,'display_currency': website.currency_id}" />
                        </a>
                        <a t-if="99 - website_sale_order.amount_total &lt;= 0" class="btn btn-block btn-primary">You get free delivery!!!</a>
                    </div>
                </div>
            </div>
        </xpath>
    </template>

    <!--Hide price in recently viewed items list at cart view-->
    <template id="recent_cart_product_custom" inherit_id="clarico_recently_viewed.recent_cart_product">

        <xpath expr="//div[@class='recently_viewed_img_div']" position="replace">
            <div class="recently_viewed_img_div">
                <a itemprop="url" t-att-href="'/shop/product/%s' % slug(rproduct)">
                    <span itemprop="image" />
                    <div class="div_c_sub_pc_image">
                        <div class="ribbon-wrapper" t-if="rproduct.label_ept_id">
                            <div class="ribbon btn btn-danger sale-btn" t-field="rproduct.label_ept_id"></div>
                        </div>
                        <span itemprop="image" t-field="rproduct.image_medium"
                              t-options="{'widget': 'image'}" t-att-alt="rproduct.name" />
                    </div>
                </a>
            </div>
        </xpath>

        <xpath expr="//div[@class='recently_view_product_price']" position="replace">
            <t t-if="not rproduct.hide_website_price">
                <div class="recently_view_product_price">
                    <t t-if="(compute_currency(rproduct.lst_price) - rproduct.website_price ) &gt; 0.01  and website.get_current_pricelist().discount_policy=='without_discount'">
                        <del class="text-danger mr8 " style="white-space: nowrap;"
                             t-esc="compute_currency(rproduct.website_public_price)"
                             t-options="{'widget': 'monetary', 'display_currency': website.get_current_pricelist().currency_id, 'from_currency': website.currency_id}" />
                    </t>
                    <span class="text-danger oe_default_price"
                          style="text-decoration: line-through; white-space: nowrap;"
                          t-esc="compute_currency(rproduct.website_public_price)"
                          t-options="{'widget': 'monetary', 'display_currency': website.get_current_pricelist().currency_id, 'from_currency': website.currency_id}"
                          t-att-style="'text-decoration: line-through; white-space: nowrap; ' + '' if (compute_currency(rproduct.lst_price) - rproduct.website_price) &gt; 0.01 and website.get_current_pricelist().discount_policy == 'without_discount' else 'display: none;'" />

                    <b class="oe_price" style="white-space: nowrap;" t-esc="rproduct.website_price"
                       t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" />
                    <span itemprop="price" style="display:none;" t-esc="rproduct.website_price" />
                    <span itemprop="priceCurrency" style="display:none;"
                          t-esc="website.currency_id.name" />
                </div>
            </t>
            <t t-else="">
                <b>N/D</b>
            </t>
        </xpath>
    </template>

    <!--Hide price in suggested_products_list at cart view-->
    <template id="suggested_products_list_custom" inherit_id="website_sale.suggested_products_list">
        <xpath expr="//span[@t-field='product.website_price']" position="replace">
            <t t-if="not product.hide_website_price">
            <span t-field="product.website_price" style="white-space: nowrap;" t-options="{'widget': 'monetary','display_currency': website.currency_id}" />
            </t>
            <t t-else="">
                <span>N/D</span>
            </t>
        </xpath>
    </template>

</odoo>